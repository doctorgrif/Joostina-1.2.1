(function(b){jQuery.fn.auto_upload=function(e){function l(){function c(f){var c={},i="undefined"!=typeof f.fileName?f.fileName:f.name;if(e.start(i,c)){var d=new XMLHttpRequest;d.onload=function(){e.finish(d.responseText,i,c)};d.upload.onprogress=function(a){e.progress(a.loaded/a.total,i,c)};d.onerror=function(a){e.error(name,a,c)};var l=g.attr("method"),n=g.attr("action");d.open(l,n,!0);d.setRequestHeader("Cache-Control","no-cache");d.setRequestHeader("X-Requested-With","XMLHttpRequest");d.setRequestHeader("X-File-Name",
i);d.setRequestHeader("X-File-Size",f.fileSize);if(window.FormData){var m=new FormData;b.each(h,function(a,c){m.append(c.name,c.value)});m.append(j,f);d.send(m)}else if(f.getAsBinary){var k="------multipartformboundary"+(new Date).getTime();d.setRequestHeader("content-type","multipart/form-data; boundary="+k);var a="";b.each(h,function(c,b){a+="--"+k+"\r\n";a+='Content-Disposition: form-data; name="'+unescape(encodeURIComponent(b.name))+'"';a+="\r\n\r\n";a+=unescape(encodeURIComponent(b.value));a+=
"\r\n"});a+="--"+k+"\r\n";a+='Content-Disposition: form-data; name="'+j+'"; filename="'+unescape(encodeURIComponent(i))+'"';a+="\r\n";a+="Content-Type: application/octet-stream";a+="\r\n\r\n";a+=f.getAsBinary();a+="\r\n";a+="--"+k+"--";a+="\r\n";d.sendAsBinary(a)}}}var j=b(this).attr("name"),g=b(this.form),h=g.serializeArray();b.each(this.files,function(b,e){c(e,b)});this.form.reset()}function n(){$input=b(this);$form=b(this.form);$input.bind("change",function(){for(var c=this.value.toString();(pos=
c.search("\\\\"))&&!(-1==pos);)c=c.substr(pos+1);var j={};e.start(c,j);var g="gp_"+Math.round(1E7*Math.random()),h=b('<iframe name="'+g+'" id="'+g+'" style="display:none"></iframe>').appendTo("body");$form.attr("target",g).one("submit",function(){h.one("load",function(){var b=h.contents().find("html").html();e.finish(b,c,j);setTimeout(function(){h.remove()},10)})}).submit()})}var e=b.extend({},b.fn.auto_upload.defaults,e),o=function(){var b=document.createElement("input");b.type="file";return"multiple"in
b&&"undefined"!=typeof File&&("undefined"!==typeof FormData||"undefined"!==typeof FileReader)&&"undefined"!=typeof XMLHttpRequest&&"undefined"!=typeof(new XMLHttpRequest).upload}();return b(this).each(function(){$this=b(this);o?($this.attr("multiple","multiple"),$this.bind("change.auto_upload",l)):n.call(this);$this.bind("destroy.auto_upload",function(){$this.unbind(".auto_upload")})})};b.fn.auto_upload.defaults={start:function(){return!0},progress:function(){},finish:function(){},error:function(){}}})(jQuery);